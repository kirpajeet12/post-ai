# AI ORDERING BOT â€” COMPLETE INSTRUCTIONS
### Everything you need to know, step by step

---

## WHAT WE BUILT

A voice + terminal AI ordering system that works for **any restaurant, cafe, or business**.

```
Customer speaks / types
        â†“
   AI understands
        â†“
   Order is built
        â†“
   Sent to your POS
        â†“
   Kitchen gets ticket
```

It works in 3 modes:
- **Terminal** â€” type orders in the command line
- **Phone** â€” customer calls, AI answers (needs Twilio)
- **Any POS** â€” plug in Square, custom API, or mock/print

---

## THE FILES â€” WHAT EACH ONE DOES

```
tim_ai/
â”‚
â”œâ”€â”€ setup_wizard.py   â† Run FIRST. Sets up everything.
â”œâ”€â”€ bot.py            â† Run every day. The main ordering bot.
â”œâ”€â”€ cli.py            â† Simple version, no setup needed.
â”œâ”€â”€ server.py         â† Phone call server (Twilio only).
â”‚
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ menu.py       â† Built-in Tim Hortons demo menu.
â”‚   â”œâ”€â”€ order.py      â† Order data structure (LineItem, Order).
â”‚   â””â”€â”€ engine.py     â† Brain â€” handles state, upsells, confirmation.
â”‚
â”œâ”€â”€ parser/
â”‚   â””â”€â”€ parser.py     â† Converts "medium double double" â†’ structured data.
â”‚
â”œâ”€â”€ ai_engine/
â”‚   â””â”€â”€ llm.py        â† Connects to OpenAI / Anthropic / Mock AI.
â”‚
â”œâ”€â”€ pos_adapters/
â”‚   â”œâ”€â”€ mock_pos.py   â† Prints order to terminal (for testing).
â”‚   â”œâ”€â”€ square_pos.py â† Sends order to Square POS.
â”‚   â””â”€â”€ custom_pos.py â† Works with any REST API POS.
â”‚
â”œâ”€â”€ telephony/
â”‚   â””â”€â”€ twilio_handler.py â† Handles phone calls via Twilio.
â”‚
â”œâ”€â”€ .env              â† Your config (API keys, POS, business name).
â”œâ”€â”€ .env.example      â† Template for .env.
â”œâ”€â”€ menu_custom.json  â† Your custom menu (created by setup wizard).
â””â”€â”€ requirements.txt  â† Python packages needed.
```

---

## QUICK START â€” 3 COMMANDS

```bash
# 1. Install packages
pip install -r requirements.txt

# 2. Run setup (first time only)
python setup_wizard.py

# 3. Start the bot
python bot.py
```

---

## STEP 1 â€” INSTALL

```bash
cd /workspaces/post-ai/tim_ai
pip install -r requirements.txt
```

What gets installed:
- `openai` â€” OpenAI API
- `anthropic` â€” Claude API
- `twilio` â€” Phone calls
- `fastapi` + `uvicorn` â€” Web server for Twilio
- `python-dotenv` â€” Reads your .env file
- `requests` â€” HTTP calls to POS

---

## STEP 2 â€” SETUP WIZARD (First Time)

```bash
python setup_wizard.py
```

The wizard asks you 5 things:

**1. Your Business**
```
Business name: [Pizza Palace]
Type: Restaurant / Cafe / Pizza Shop / Food Truck / Retail / Other
Greeting: Hi! Welcome to Pizza Palace. What can I get for you?
```

**2. AI Provider**
```
1. OpenAI (GPT-4o)     â†’ needs API key from platform.openai.com
2. Anthropic (Claude)  â†’ needs API key from console.anthropic.com
3. Mock / No AI        â†’ FREE, no key, rule-based matching
```

**3. POS System**
```
1. Terminal/mock       â†’ prints order to screen (start here)
2. Square POS          â†’ needs Square developer account
3. Custom REST API     â†’ works with any POS that has an API
4. Skip                â†’ set up later
```

**4. Menu**
```
1. Type items now      â†’ add items one by one in terminal
2. Load from JSON      â†’ point to your menu.json file
3. Load from CSV       â†’ point to your menu.csv file
4. Tim Hortons demo    â†’ use the built-in demo menu
5. Skip                â†’ edit menu_custom.json manually
```

**5. Phone / Twilio (Optional)**
```
1. No â€” terminal only
2. Yes â€” enter Twilio credentials
```

Everything saves to `.env` automatically.

---

## STEP 3 â€” RUN THE BOT

```bash
python bot.py
```

### Commands you can type while ordering:

| Command | What it does |
|---------|-------------|
| `menu` | Show full menu with prices |
| `order` | Show current order so far |
| `done` | Finalize and confirm order |
| `cancel` | Start over |
| `quit` | Exit the bot |

### Example ordering session:

```
ðŸ¤– AI: Hi! Welcome to Tim Hortons. What can I get for you?

ðŸ‘¤ YOU: medium double double and a bacon breakfast sandwich

ðŸ¤– AI: Got it â€” 1x Medium Coffee (double double), 1x Bacon Breakfast Sandwich.
       Would you like to add a hash brown for $1.99?

ðŸ‘¤ YOU: no thanks

ðŸ¤– AI: No problem. Anything else for you?

ðŸ‘¤ YOU: thats all

ðŸ¤– AI: Just to confirm, you have:
         - 1x Medium Coffee (double double)
         - 1x Bacon Breakfast Sandwich
       Say 'yes' to place it or 'no' to make changes.

ðŸ‘¤ YOU: yes

ðŸ¤– AI: âœ… Order placed! #MOCK-A1B2C3. Thank you!
```

---

## DIFFERENT WAYS TO RUN IT

### Way 1 â€” No API Key (Free, Rule-Based)
```bash
python bot.py
```
- Uses pattern matching to understand orders
- No internet needed
- Works offline
- Good for testing and demos

### Way 2 â€” With OpenAI
```bash
# Add to .env:
AI_PROVIDER=openai
OPENAI_API_KEY=sk-...

python bot.py
```
- GPT-4o understands messy / natural speech
- Handles complex requests better
- Costs ~$0.01 per conversation

### Way 3 â€” With Anthropic (Claude)
```bash
# Add to .env:
AI_PROVIDER=anthropic
ANTHROPIC_API_KEY=sk-ant-...

python bot.py
```
- Same as OpenAI option but uses Claude
- Great at following instructions precisely

### Way 4 â€” Old Simple Terminal (No Setup Needed)
```bash
python cli.py

# With real AI:
python cli.py --use-ai
```
- Simpler version
- No setup wizard
- Uses default Tim Hortons menu

### Way 5 â€” Phone Calls (Twilio)
```bash
# 1. Start the server
python server.py

# 2. In a second terminal, expose it publicly
ngrok http 8000

# 3. Set your Twilio webhook to:
#    https://your-ngrok-url.ngrok.io/voice

# Now call your Twilio number â€” AI answers!
```

---

## SETTING UP YOUR OWN MENU

### Option A â€” Through Setup Wizard
```bash
python setup_wizard.py
# Choose: "Update menu only"
# Then: "Type items now"
```

### Option B â€” Edit the JSON File Directly

Open `menu_custom.json` and add items like this:

```json
{
  "margherita pizza": {
    "category": "pizza",
    "aliases": ["margherita", "cheese pizza", "margherita pizza"],
    "sizes": ["small", "medium", "large"],
    "modifiers": ["extra cheese", "no basil", "thin crust"],
    "base_price": 12.99,
    "pos_item_id": "PIZZA_MARG"
  },
  "garlic bread": {
    "category": "sides",
    "aliases": ["garlic bread", "bread"],
    "sizes": null,
    "modifiers": ["extra butter"],
    "base_price": 4.99,
    "pos_item_id": "SIDE_GB"
  }
}
```

**Key fields:**
- `aliases` â†’ words customers might say ("cheese pizza", "marg", "margherita")
- `sizes` â†’ set to `null` if item has no size options
- `modifiers` â†’ add-ons or changes customers can ask for
- `base_price` â†’ used by mock POS (real POS overrides this)
- `pos_item_id` â†’ your POS system's ID for this item

### Option C â€” Load from CSV

Create a file `my_menu.csv`:
```
name,category,price,sizes,modifiers
latte,drinks,4.99,"small,medium,large","oat milk,almond milk,extra shot"
croissant,food,3.49,,butter
```

Then run:
```bash
python setup_wizard.py
# Choose: "Update menu only" â†’ "Load from CSV"
# Enter path: /workspaces/post-ai/tim_ai/my_menu.csv
```

---

## CONNECTING A REAL POS

### Square POS

1. Go to **developer.squareup.com** â†’ create app
2. Get **Access Token** and **Location ID**
3. Add to `.env`:
```
POS_ADAPTER=square
SQUARE_ACCESS_TOKEN=EAAAxxxxxxxxxx
SQUARE_LOCATION_ID=Lxxxxxxxxxx
```
4. In `core/menu.py`, add `square_variation_id` to each item matching your Square catalog

### Custom POS (Any REST API)

1. Add to `.env`:
```
POS_ADAPTER=custom
CUSTOM_POS_BASE_URL=https://your-pos.com
CUSTOM_POS_API_KEY=your-key
CUSTOM_POS_ORDER_ENDPOINT=/api/orders
```

2. Open `pos_adapters/custom_pos.py`
3. Edit `_transform_order()` to match what your POS expects:
```python
def _transform_order(self, order_dict: dict) -> dict:
    # Reshape the data to match your POS API format
    return {
        "external_id": order_dict["id"],
        "lines": [
            {
                "sku": item["name"],
                "qty": item["qty"],
                "notes": ", ".join(item["modifiers"])
            }
            for item in order_dict["items"]
        ]
    }
```

### Build Your Own POS Adapter

Create `pos_adapters/my_pos.py`:
```python
from pos_adapters.base import BasePOS

class MyPOS(BasePOS):
    def send_order(self, order_dict: dict) -> dict:
        # Your code to send order to your system
        return {
            "success": True,
            "pos_order_id": "12345",
            "message": "Order received"
        }

    def check_availability(self, item_name: str) -> bool:
        return True  # Check your inventory here
```

Then in `.env`:
```
POS_ADAPTER=my_pos
```

---

## CONNECTING PHONE CALLS (TWILIO)

### Step 1 â€” Get Twilio Account
1. Go to **twilio.com** â†’ sign up free
2. Get a phone number (~$1/month)
3. Copy your **Account SID** and **Auth Token**

### Step 2 â€” Add to .env
```
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=xxxxxxxxxxxxxxxx
TWILIO_PHONE_NUMBER=+16041234567
BASE_URL=https://your-server.com
```

### Step 3 â€” Run the Server
```bash
python server.py
```

### Step 4 â€” Expose to Internet (for testing)
```bash
# Install ngrok from ngrok.com then:
ngrok http 8000
# Copy the https URL it gives you
```

### Step 5 â€” Connect Twilio
1. Go to twilio.com/console
2. Click your phone number
3. Under **Voice**, set webhook to:
   `https://your-ngrok-url.ngrok.io/voice`
4. Call your number â€” AI answers!

---

## DEPLOY TO A REAL SERVER

### Railway (Easiest â€” Free Tier)
```bash
# Install Railway CLI
npm install -g @railway/cli

# Login and deploy
railway login
railway init
railway up
```

### Render (Also Free)
1. Go to **render.com** â†’ New Web Service
2. Connect your GitHub repo
3. Set start command: `python server.py`
4. Add environment variables from your `.env`

### DigitalOcean ($5/month)
```bash
# On the server:
git clone https://github.com/yourname/tim-ai.git
cd tim-ai/tim_ai
pip install -r requirements.txt
cp .env.example .env
# Edit .env with your keys
python server.py
```

---

## RUNNING TESTS

```bash
cd /workspaces/post-ai/tim_ai
python tests/test_parser.py
```

Should print: `17/17 passed`

Tests check:
- Single item parsing ("medium double double")
- Multi-item parsing ("coffee and a sandwich")
- Size defaults (no size given â†’ medium)
- Modifier detection ("no sauce", "biscuit")
- Quantity words ("two hash browns")
- Order engine (add, cancel, confirm)
- Upsell logic

---

## COMMON ERRORS AND FIXES

### "No config found. Run setup first."
```bash
python setup_wizard.py
```

### "Module not found"
```bash
pip install -r requirements.txt
```

### "Cannot find tim_ai_v3.zip"
You don't need the zip. The code is already in your repo. Just run:
```bash
python bot.py
```

### "cd: workspaces: No such file or directory"
Always use the full path:
```bash
cd /workspaces/post-ai/tim_ai
```

### AI only catches one item when ordering multiple
Fixed in v2+. Make sure you have the latest `parser/parser.py`.
Test with: `"medium coffee and a bacon sandwich"`

### "no i want it small" not working
Fixed in v3+. Make sure you have the latest `core/engine.py`.

---

## UPDATING YOUR CONFIG ANYTIME

```bash
python setup_wizard.py
```

Choose:
- **Reconfigure everything** â€” full setup again
- **Update menu only** â€” add/change items
- **Update API keys only** â€” change AI provider or keys

---

## THE .ENV FILE â€” ALL OPTIONS

```bash
# Business
BUSINESS_NAME=My Restaurant
BUSINESS_TYPE=Restaurant
GREETING_MSG=Hi! Welcome to My Restaurant. What can I get for you?

# AI (pick one)
AI_PROVIDER=mock           # mock | openai | anthropic
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...

# POS (pick one)
POS_ADAPTER=mock           # mock | square | custom
SQUARE_ACCESS_TOKEN=...
SQUARE_LOCATION_ID=...
CUSTOM_POS_BASE_URL=...
CUSTOM_POS_API_KEY=...
CUSTOM_POS_ORDER_ENDPOINT=/api/orders

# Phone (optional)
TWILIO_ACCOUNT_SID=...
TWILIO_AUTH_TOKEN=...
TWILIO_PHONE_NUMBER=+1...
BASE_URL=https://your-server.com

# Menu
MENU_FILE=menu_custom.json  # or core/menu.py for demo
```

---

## ROADMAP â€” WHAT TO BUILD NEXT

| Feature | Effort | Value |
|---------|--------|-------|
| SMS confirmation after order | Low | High |
| Admin dashboard (orders today) | Medium | High |
| Customer profiles ("same as last time") | Medium | High |
| ElevenLabs voice (more natural) | Low | Medium |
| Multi-language support | Medium | High |
| Inventory tracking | High | High |
| Stripe payment over phone | High | Very High |

---

## SAVE VERSIONS IN GITHUB

```bash
# Tag current version
git add .
git commit -m "v1 - terminal bot working"
git tag v1.0
git push
git push origin v1.0

# After adding Twilio
git tag v2.0
git push origin v2.0
```

View all versions on GitHub under the **Releases** tab.

---

## SUMMARY â€” COMMANDS YOU'LL USE MOST

```bash
# Navigate to project
cd /workspaces/post-ai/tim_ai

# Install packages (once)
pip install -r requirements.txt

# First time setup
python setup_wizard.py

# Run the bot
python bot.py

# Run tests
python tests/test_parser.py

# Run phone server
python server.py

# Save to GitHub
git add .
git commit -m "your message"
git push
```

---

*Built with Python â€” works on any computer, any restaurant, any POS.*
